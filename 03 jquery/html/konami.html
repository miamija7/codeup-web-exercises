<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario-Konami Code</title>
    <link rel="icon" href="../img/mario.png" type = "image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'VT323', monospace;
            background-image: url("../img/mario-bg.png");
            background-repeat: repeat-x;
            background-size: cover;
            color: white;
            font-size: 1.5em;
        }

        .header {
            display: flex;
            justify-content: space-around;
        }

        p {
            color: white;
            opacity: 20%;
            text-align: center;
            margin: 0;
            font-size: 0.75em
        }

        .flip-horizontally {
            transform: scaleX(-1);
        }
    </style>
</head>
<body>
<div class="header">
    <h1>MARIO<br><span class="points">000000</span></h1>
    <h1>LIVES x <span class="lives"></span></h1>
    <h1><img style="width: 0.6em" src="../img/coin.png" alt="coin"> x 05</h1>
    <h1 style="text-align: center">WORLD<br>1-1</h1>
    <h1 style="text-align: right">TIME<br><span class="time"></span></h1>
</div>
<p>Konami Code: ↑ ↑ ↓ ↓ ← → ← → b a [enter]</p>
<img class="mario" src="../img/mario.png" alt="mario" style="width: 6em;">
<script src="../js/jquery.js"></script>
<script>
    "use strict";

    /////////////////
    // KONAMI CODE //
    /////////////////
    let keyBuffer = "";
    const bufferLimit = 22;
    const konamiCode = "3838404037393739666513";

    $(document).keyup(function (event) {
        // store event keyCodes
        keyBuffer = (keyBuffer + ((event.keyCode).toString()));

        // trim buffer
        if (keyBuffer.length > 22) {
            keyBuffer = keyBuffer.substring(keyBuffer.length - bufferLimit);
        }

        // identify konami code
        if (keyBuffer === konamiCode) {
            alert("+ 30 LIVES!");
        }
    });

    /////////////////
    // LIVE HEADER //
    /////////////////
    const pointsDisplay = document.querySelector(".points");
    const livesDisplay = document.querySelector(".lives");
    const timeDisplay = document.querySelector(".time");

    pointsDisplay.textContent = "000000";
    livesDisplay.textContent = "3";
    timeDisplay.textContent = "0";

    // timer
    let timer = setInterval(function () {
        timeDisplay.textContent = (parseInt(timeDisplay.textContent) + 1).toString();
    }, 100)

    // end timer after 10 minutes
    let timeout = setTimeout(function () {
        clearInterval(timer);
    }, 600000)

    // keyup events for header
    $(document).keyup(function (event) {
        // header points handler
        let pointsEarned = parseInt(event.keyCode);
        pointsDisplay.textContent = ("0000" + (parseInt(pointsDisplay.textContent) + pointsEarned).toString());
        pointsDisplay.textContent = pointsDisplay.textContent.substring(pointsDisplay.textContent.length - 6);

        if (keyBuffer === konamiCode) {
            // header lives handler
            livesDisplay.textContent = (parseInt(livesDisplay.textContent) + 30).toString();
        }
    })

    // pause game
    $(document).click(function () {
        alert("GAME PAUSED\n\nDirections:\nMove mario around!\nEarn points with key events.\nKonami code gets you more lives!\n\nclick ok to resume");
    })

    /////////////////
    //    MARIO    //
    /////////////////
    let marioSelector = document.querySelector(".mario");
    let background = document.querySelector("body");

    window.addEventListener('load', () => {
        marioSelector.style.position = 'absolute';
        marioSelector.style.left = '50px';
        marioSelector.style.top = '200px';
        background.style.backgroundPositionX = 0;
    });

    window.addEventListener('keyup', (event) => {
        if (event.key === 'ArrowLeft') {
            marioSelector.classList.add("flip-horizontally");
            if (marioSelector.style.left.toString() !== '0px') {
                marioSelector.style.left = parseInt(marioSelector.style.left) - 50 + 'px';
            }
            background.style.backgroundPositionX = parseInt(background.style.backgroundPositionX) + 50 + 'px';

        } else if (event.key === 'ArrowRight') {
            marioSelector.classList.remove("flip-horizontally");
            if (marioSelector.style.left.toString() !== '1250px') {
                marioSelector.style.left = parseInt(marioSelector.style.left) + 50 + 'px';
            }
            background.style.backgroundPositionX = parseInt(background.style.backgroundPositionX) - 50 + 'px';

        } else if (event.key === 'ArrowUp') {
            if (marioSelector.style.top.toString() !== '0px')
                marioSelector.style.top = parseInt(marioSelector.style.top) - 50 + 'px';
        } else if (event.key === 'ArrowDown') {
            if (marioSelector.style.top.toString() !== '550px')
                marioSelector.style.top = parseInt(marioSelector.style.top) + 50 + 'px';
        }
    })


</script>
</body>
</html>